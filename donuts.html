<!DOCTYPE html>
<html>
  <head>
    <title>HTML5</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=650, user-scalable=yes">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
 

 
    <link rel="stylesheet"  href="css/style.css">
    <!-- move this into your css file -->
 
  </head>
  <body>
    <svg id="viz" height="500" width="800" style="border: 1px solid grey;">
    </svg>
    <script type="text/javascript">
      var data = {
        "facebook":{
            "total": 72,
            "male": 66,
            "female": 77,
            "white": 70,
            "black": 67,
            "hispanic": 75,
            "young": 82,
            "middle": 79,
            "old": 64,
            "senior": 48,
            "highschool": 71,
            "some": 72,
            "college": 72,
            "poor": 73,
            "fine": 72,
            "average": 66,
            "rich": 78,
            "urban": 74,
            "suburban": 72,
            "rural": 67
        },
        "pinterest":{
            "total": 31,
            "male": 16,
            "female": 44,
            "white": 32,
            "black": 23,
            "hispanic": 32,
            "young": 82,
            "middle": 79,
            "old": 64,
            "senior": 48,
            "highschool": 71,
            "some": 72,
            "college": 72,
            "poor": 73,
            "fine": 72,
            "average": 66,
            "rich": 78,
            "urban": 74,
            "suburban": 72,
            "rural": 67,
        },
        "instagram":{
            "total": 72,
            "male": 66,
            "female": 77,
            "white": 70,
            "black": 67,
            "hispanic": 75,
            "young": 82,
            "middle": 79,
            "old": 64,
            "senior": 48,
            "highschool": 71,
            "some": 72,
            "college": 72,
            "poor": 73,
            "fine": 72,
            "average": 66,
            "rich": 78,
            "urban": 74,
            "suburban": 72,
            "rural": 67,
        },
        "linkedin":{
            "total": 25,
            "male": 26,
            "female": 25,
            "white": 26,
            "black": 22,
            "hispanic": 22,
            "young": 22,
            "middle": 32,
            "old": 36,
            "senior": 12,
            "highschool": 9,
            "some": 25,
            "college": 46,
            "poor": 17,
            "fine": 21,
            "average": 32,
            "rich": 41,
            "urban": 30,
            "suburban": 26,
            "rural": 12
        },
        "twitter":{
            "total": 23,
            "male": 25,
            "female": 21,
            "white": 20,
            "black": 28,
            "hispanic": 28,
            "young": 32,
            "middle": 29,
            "old": 13,
            "senior": 6,
            "highschool": 19,
            "some": 23,
            "college": 27,
            "poor": 21,
            "fine": 19,
            "average": 25,
            "rich": 26,
            "urban": 30,
            "suburban": 21,
            "rural": 15
        }
    }
    var sites = ["facebook","pinterest","instagram","linkedin","twitter"];
    var demos = {
        "gender": ["male","female"],
        "race": ["white","black","hispanic"],
        "age": ["young","middle","old","senior"],
        "school": ["highschool","some","college"],
        "money": ["poor","fine","average","rich"],
        "loc": ["urban","suburban","rural"]
    }
    formatted = {}
    Object.keys(data["facebook"]).forEach(function(demo){
        formatted[demo] = [];
    });
    Object.keys(data).forEach(function(site){
        Object.keys(data[site]).forEach(function(demo){
            formatted[demo].push(data[site][demo])
        });
    });
    console.log(formatted);
    height = 500
    width = 800
    
    function donut(site, demo){
        var dataset = [];
        demos[demo].forEach(function(d, i){
            dataset.push(data[site][d]);
        });
        var svg = d3.select("#viz")
        .append('g')
        .attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')');

        var color = d3.scale.category20b();
        outr = 200
        var arc = d3.svg.arc()
        .innerRadius(outr - (outr * data[site]["total"]/100))
        .outerRadius(outr);

        var pie = d3.layout.pie()
        .value(function(d) { return d; })
        .sort(null);

        var path = svg.selectAll('path')
            .data(pie(dataset))
            .enter()
            .append('path')
            .attr('d', arc)
            .attr('fill', function(d, i) { 
                return color(i*4);
            });
    }
    donut("linkedin","race")    
    </script>
  </body>
</html>